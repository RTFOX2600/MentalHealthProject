# 学生思想健康分析系统 - 演示模块使用说明

## 功能概述

本系统提供了一个完整的数据分析演示平台，主要功能包括上传五种类型的学生数据表格，通过AI算法进行综合分析、精准思政分析和精准扶贫分析，最终生成可下载的Excel报告。所有数据存储在数据库中，无需保存表格文件，演示完成后可以一键清理。

## 主要特性

1. **数据上传**: 支持CSV和Excel格式的5种数据表格
   - 食堂消费统计表
   - 校门进出记录表
   - 寝室门禁记录表
   - 网络访问记录表
   - 各科成绩表

2. **三种分析模式**:
   - **综合分析**: 基于全部5个表格，识别需要关注的学生
   - **精准思政分析**: 基于网络行为和成绩数据，进行思想健康画像
   - **精准扶贫分析**: 基于食堂消费和校门进出数据，识别经济困难学生

3. **数据库存储**: 所有上传的数据自动保存到数据库，按会话管理
4. **Excel报告生成**: 分析完成后自动生成并下载Excel报告
5. **用户隔离**: 每个登录用户的数据独立存储，互不干扰

## 使用流程

### 1. 访问演示页面
登录后点击首页的"进入工作台"按钮，或直接访问 `/mental_health/demo/`

### 2. 上传数据表格
按照页面提示上传5个表格文件：
- 支持.csv、.xlsx、.xls格式
- 支持拖拽上传或点击选择文件
- 上传后会显示成功提示和基本统计信息

### 3. 选择分析类型
根据上传的表格，不同的分析按钮会自动激活：
- **综合分析**: 需要全部5个表格
- **精准思政**: 需要网络访问记录表 + 各科成绩表
- **精准扶贫**: 需要食堂消费统计表 + 校门进出记录表

### 4. 执行分析并下载报告
点击相应的分析按钮，系统会：
1. 从数据库读取已上传的数据
2. 执行相应的分析算法
3. 生成Excel报告
4. 自动开始下载

## 数据表格格式要求

### 1. 食堂消费统计表
| 学号 | 年份-月份 | 食堂消费额度（本月） |
|------|----------|-------------------|
| 20230001 | 2024-01 | 500.50 |

### 2. 校门进出记录表
| 学号 | 校门进出时间 | 进出方向 | 位置 |
|------|------------|---------|------|
| 20230001 | 2024-01-15 08:00:00 | 出 | 南门 |

### 3. 寝室门禁记录表
| 学号 | 寝室进出时间 | 进出方向 | 楼栋 |
|------|------------|---------|------|
| 20230001 | 2024-01-15 22:00:00 | 进 | 1号楼 |

### 4. 网络访问记录表
| 学号 | 开始时间 | 访问域名 | 是否使用VPN |
|------|---------|---------|-----------|
| 20230001 | 2024-01-15 10:00:00 | www.baidu.com | 否 |

### 5. 各科成绩表
| 学号 | 年份-月份 | 高等数学 | 大学英语 | ... |
|------|----------|---------|---------|-----|
| 20230001 | 2024-01 | 85.5 | 78.0 | ... |

## 分析算法说明

### 综合分析算法
使用孤立森林（Isolation Forest）机器学习算法，综合考虑：
- 食堂消费模式（月均、波动、趋势）
- 校门进出频率（夜间外出、周末活动）
- 寝室门禁规律（深夜进出、归寝规律）
- 网络使用习惯（访问频率、VPN使用、夜间访问）
- 学业表现（平均分、不及格科次、成绩趋势）

输出包括风险等级（高/中/低）、风险原因和建议谈话重点。

### 精准思政分析算法
基于三级指标体系：
1. **正向度**: 基于访问网站类型和VPN使用情况
2. **情绪强度**: 基于访问频率和时间分布
3. **激进度**: 结合网络行为和学业表现

将学生分为11种画像类型（小心翼翼型、活跃激进型等），并提供相应的工作策略。

### 精准扶贫分析算法
主要指标：
- 月均消费水平
- 低消费月份数量
- 消费趋势
- 周末外出频率（辅助指标）

判定三个困难等级（特别困难/困难/一般困难），提供帮助建议（助学金、勤工助学等）。

## 技术架构

### 后端
- **框架**: Django 6.0
- **数据库**: SQLite（开发环境）
- **数据处理**: pandas, numpy
- **机器学习**: scikit-learn
- **Excel生成**: openpyxl

### 前端
- **界面**: 原生HTML/CSS/JavaScript
- **特效**: 渐变背景、卡片动画、进度条
- **交互**: 拖拽上传、实时反馈

### 数据模型
- `UploadedDataSet`: 数据集会话
- `CanteenConsumption`: 食堂消费记录
- `SchoolGateRecord`: 校门进出记录
- `DormGateRecord`: 寝室门禁记录
- `NetworkAccessRecord`: 网络访问记录
- `GradeRecord`: 成绩记录（JSON存储）
- `AnalysisResult`: 分析结果和报告文件

## 开发者说明

### 本地运行
```bash
# 安装依赖
pip install -r requirements.txt

# 数据库迁移
python manage.py makemigrations
python manage.py migrate

# 启动开发服务器
python manage.py runserver
```

### 清理数据
如需清理测试数据，可以在Django Admin中删除相关记录，或使用Django shell:
```python
from mental_health.models import UploadedDataSet
# 删除所有测试数据
UploadedDataSet.objects.all().delete()
```

### 扩展分析算法
要添加新的分析类型，需要：
1. 在`core/mental_health/analyse.py`中创建新的分析器类
2. 在`mental_health/views.py`的`analyze_data`函数中添加对应逻辑
3. 在前端`demo.html`中添加新的按钮和处理逻辑

## 注意事项

1. **数据隐私**: 本系统处理敏感的学生数据，务必确保服务器安全
2. **性能优化**: 大数据量时建议使用批量插入（已实现）
3. **会话管理**: 基于Django session，退出登录后会话ID仍保留
4. **文件大小**: 建议单个表格不超过10MB
5. **分析参数**: 当前算法参数已优化，可根据实际情况调整阈值

## 后续优化建议

1. **前端参数配置**: 允许用户在前端调整分析算法的阈值参数
2. **历史记录查看**: 提供已分析数据集的历史记录查询功能
3. **数据可视化**: 添加图表展示，如成绩趋势图、消费分布图等
4. **批量导出**: 支持一键导出所有分析报告
5. **数据验证增强**: 更严格的数据格式和完整性检查
6. **异步处理**: 大数据量分析时使用Celery异步任务队列
7. **缓存优化**: 使用Redis缓存频繁查询的数据

## 常见问题

**Q: 上传失败怎么办？**  
A: 检查文件格式和列名是否符合要求，可查看浏览器控制台的详细错误信息。

**Q: 分析按钮无法点击？**  
A: 确保已上传相应分析类型所需的全部表格。

**Q: 下载的Excel文件打开乱码？**  
A: 确保使用最新版本的Excel或WPS，文件编码为UTF-8。

**Q: 可以修改已上传的数据吗？**  
A: 当前版本需要重新上传，上传会覆盖之前的数据。

**Q: 数据会保存多久？**  
A: 数据会一直保存，除非手动删除或清空数据库。

## 联系方式

如有问题或建议，请联系系统管理员或开发团队。
