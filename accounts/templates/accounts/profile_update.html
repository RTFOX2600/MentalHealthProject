{% extends 'base.html' %}
{% load static %}

{% block title %}修改个人信息 - 思想关怀系统{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/input_components.css' %}">
{% endblock %}

{% block content %}
    <h2>修改个人信息</h2>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    <form method="post">
        {% csrf_token %}
        
        <!-- 姓 -->
        <div class="mb-3">
            <label for="{{ form.last_name.id_for_label }}" class="form-label">{{ form.last_name.label }}</label>
            {{ form.last_name }}
            {% if form.last_name.errors %}
                <div class="text-danger small">{{ form.last_name.errors }}</div>
            {% endif %}
        </div>
        
        <!-- 名 -->
        <div class="mb-3">
            <label for="{{ form.first_name.id_for_label }}" class="form-label">{{ form.first_name.label }}</label>
            {{ form.first_name }}
            {% if form.first_name.errors %}
                <div class="text-danger small">{{ form.first_name.errors }}</div>
            {% endif %}
        </div>
        
        <!-- 角色选择（自定义下拉菜单） -->
        <div class="mb-3">
            <label class="form-label">{{ form.role.label }}</label>
            <div class="custom-dropdown">
                <div class="dropdown-trigger">
                    <span class="selected-text">
                        {% if form.role.value == 'student' %}学生
                        {% elif form.role.value == 'counselor' %}辅导员
                        {% elif form.role.value == 'admin' %}系统管理员
                        {% else %}请选择角色
                        {% endif %}
                    </span>
                    <span class="icon" style="-webkit-mask-image: url('{% static 'icons/chevron-down.svg' %}'); mask-image: url('{% static 'icons/chevron-down.svg' %}');"></span>
                </div>
                <div class="dropdown-menu">
                    <div class="dropdown-item {% if form.role.value == 'student' %}selected{% endif %}" data-value="student">学生</div>
                    <div class="dropdown-item {% if form.role.value == 'counselor' %}selected{% endif %}" data-value="counselor">辅导员</div>
                    <div class="dropdown-item {% if form.role.value == 'admin' %}selected{% endif %}" data-value="admin">系统管理员</div>
                </div>
                <input type="hidden" id="{{ form.role.id_for_label }}" name="{{ form.role.html_name }}" value="{{ form.role.value }}">
            </div>
            {% if form.role.errors %}
                <div class="text-danger small">{{ form.role.errors }}</div>
            {% endif %}
        </div>
        
        <!-- 电子邮箱 -->
        <div class="mb-3">
            <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
            {{ form.email }}
            {% if form.email.errors %}
                <div class="text-danger small">{{ form.email.errors }}</div>
            {% endif %}
        </div>
        
        <!-- 电话号码 -->
        <div class="mb-3">
            <label for="{{ form.phone_number.id_for_label }}" class="form-label">{{ form.phone_number.label }}</label>
            {{ form.phone_number }}
            {% if form.phone_number.errors %}
                <div class="text-danger small">{{ form.phone_number.errors }}</div>
            {% endif %}
        </div>
        
        <button type="submit" class="btn btn-primary">保存修改</button>
    </form>
    <div class="footer-text">
        <a class="btn btn-secondary" href="{% url 'home' %}">返回首页</a>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/input_components.js' %}"></script>
{% endblock %}
