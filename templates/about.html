{% extends 'base.html' %}
{% load static %}

{% block title %}关于我们 - 精准思政系统{% endblock %}

{% block content_wrapper %}
<link rel="stylesheet" href="{% static 'css/about.css' %}">
<div class="about-page-container">
    <!-- 顶部横幅 -->
    <div class="hero-banner fade-in-up" style="animation-delay: 0.1s;">
        <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 1.5rem; color: white;">精准思政系统</h1>
        <p style="font-size: 1.35rem; opacity: 0.95; max-width: 750px; line-height: 1.6; color: white;">
            融合大数据分析与心理健康评估，为高校提供精准的思想引导、思政辅助与舆情监控支持。
        </p>
    </div>

    <!-- 技术栈部分 -->
    <div class="section-title fade-in-up" style="animation-delay: 0.2s;">
        <div class="dot"></div>
        <h2>项目技术栈</h2>
    </div>
    <div class="grid-container">
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--python-color); animation-delay: 0.25s;">
            <h4>Python 3.12</h4>
            <p>高性能后端驱动，负责复杂的数据清洗、分析逻辑与核心算法实现。</p>
        </div>
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--django-color); animation-delay: 0.3s;">
            <h4>Django</h4>
            <p>全能型 Web 框架，提供稳健的安全机制、ORM 管理与高效的开发流程。</p>
        </div>
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--bootstrap-color); animation-delay: 0.35s;">
            <h4>Bootstrap</h4>
            <p>现代响应式 UI，确保系统在 PC、平板与手机端均有极致的视觉表现。</p>
        </div>
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--chartjs-color); animation-delay: 0.4s;">
            <h4>Chart.js</h4>
            <p>动态数据可视化，将抽象的思想状态分析结果转化为直观的图表报告。</p>
        </div>
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--datatables-color); animation-delay: 0.45s;">
            <h4>DataTables</h4>
            <p>专业级数据展示，提供极致的表格排序、全局搜索与即时统计功能。</p>
        </div>
        <div class="tech-card fade-in-up" style="border-top: 5px solid var(--postgresql-color); animation-delay: 0.5s;">
            <h4>PostgreSQL</h4>
            <p>工业级数据底座，保障海量校园行为数据的高并发读取与持久化存储。</p>
        </div>
    </div>

    <!-- 团队部分 -->
    <div class="section-title fade-in-up" style="animation-delay: 0.1s;">
        <div class="dot"></div>
        <h2>项目团队</h2>
    </div>
    <div class="team-container">
        <div class="member-card fade-in-up" style="animation-delay: 0.15s;">
            <div>
                <span class="role-badge">Project Author</span>
                <span class="member-name" style="color: var(--primary-color);">史天润 & 申卓毅</span>
                <p class="member-desc">
                    负责系统从 0 到 1 的全栈架构设计，涵盖大数据接入、分析模型训练以及用户交互界面的深度打磨。
                </p>
            </div>
        </div>
        <div class="member-card fade-in-up" style="animation-delay: 0.2s;">
            <div>
                <span class="role-badge">Mentor</span>
                <span class="member-name" style="color: var(--success-color);">舒亦雄 老师</span>
                <p class="member-desc">
                    提供项目方向指导及业务逻辑校准，确保系统在教育管理实务中的有效落地。
                </p>
            </div>
        </div>
    </div>

    <!-- 联系方式部分 -->
    <div class="section-title fade-in-up" style="margin-top: 5rem; animation-delay: 0.25s;">
        <div class="dot"></div>
        <h2>联系方式</h2>
    </div>
    <div class="contact-container">
        <div class="contact-card fade-in-up" style="border-left: 5px solid var(--primary-color); animation-delay: 0.3s;">
            <h4>系统管理员</h4>
	        <p>如有任何系统故障或数据异常，请及时与管理员取得联系。</p>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <p>
	                <strong>史天润：</strong>
	                <a class="external-link" href="mailto:2652205627@qq.com">2652205627@qq.com</a>
                </p>
                <p>
	                <strong>申卓毅：</strong>
	                <a class="external-link" href="mailto:1578093978@qq.com">1578093978@qq.com</a>
                </p>
            </div>
	        <h4>指导老师</h4>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <p>
	                <strong>舒亦雄：</strong>
	                <a class="external-link" href="mailto:852085570@qq.com">852085570@qq.com</a>
                </p>
            </div>
        </div>
        <div class="contact-card fade-in-up" style="border-left: 5px solid #10b981; animation-delay: 0.35s;">
            <h4 style="color: var(--success-color);">学校资源</h4>
            <div style="margin-top: 0.5rem;">
                <p style="color: var(--success-color);">
	                <strong>学校官网：</strong>
	                <a class="external-link" href="https://www.whpu.edu.cn/" target="_blank">https://www.whpu.edu.cn/</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 其它项目部分 -->
    <div class="section-title fade-in-up" style="margin-top: 5rem; animation-delay: 0.1s;">
        <div class="dot"></div>
        <h2>其它项目</h2>
    </div>
    <div class="contact-container">
        <div class="contact-card fade-in-up" style="border-left: 5px solid var(--info-color); animation-delay: 0.2s;">
            <h4 style="color: var(--info-color);">班级宿舍分配系统</h4>
            <p style="margin-top: 0.5rem; margin-bottom: 1rem; color: var(--muted-text);">
                基于遗传算法的智能宿舍分配系统，自动综合考虑班级、性别、住宿偏好等多维约束，生成最优化分配方案。
            </p>
            <a href="{% static 'downloads/ez-allocation Setup 1.0.0.exe' %}" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;" download>
                <img src="{% static 'icons/download.svg' %}" alt="下载" width="18" height="18" style="filter: brightness(0) invert(1);">
                下载安装包
            </a>
        </div>
        <div class="contact-card fade-in-up" style="border-left: 5px solid var(--success-color); animation-delay: 0.3s;">
            <h4 style="color: var(--success-color);">测试数据表格</h4>
            <p style="margin-top: 0.5rem; margin-bottom: 1rem; color: var(--muted-text);">
                精准思政系统测试表格集，包含食堂消费、校门进出、宿舍门禁、网络访问和成绩记录等样例数据。
            </p>
            <button onclick="downloadTestTables()" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                <img src="{% static 'icons/download.svg' %}" alt="下载" width="18" height="18" style="filter: brightness(0) invert(1);">
                <span id="download-text">下载所有表格</span>
            </button>
        </div>
    </div>
</div>

<script>
async function downloadTestTables() {
    // 定义需要下载的文件列表（使用实际文件名）
    const files = [
        { name: '01_食堂消费月度表.csv', path: "{% static 'downloads/test_tables/01_食堂消费月度表.csv' %}" },
        { name: '02_校门进出记录表.csv', path: "{% static 'downloads/test_tables/02_校门进出记录表.csv' %}" },
        { name: '03_寝室门禁记录表.csv', path: "{% static 'downloads/test_tables/03_寝室门禁记录表.csv' %}" },
        { name: '04_网络访问记录表.csv', path: "{% static 'downloads/test_tables/04_网络访问记录表.csv' %}" },
        { name: '05_各科成绩表.csv', path: "{% static 'downloads/test_tables/05_各科成绩表.csv' %}" }
    ];
    
    const downloadText = document.getElementById('download-text');
    const originalText = downloadText.textContent;
    const btn = downloadText.closest('button');
    
    // 禁用按钮防止重复点击
    btn.disabled = true;
    
    try {
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            downloadText.textContent = `正在下载 (${i + 1}/${files.length})`;
            
            // 使用 fetch 下载文件，确保一个完成后再开始下一个
            const response = await fetch(file.path);
            if (!response.ok) throw new Error(`下载失败: ${file.name}`);
            
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            
            // 触发浏览器保存
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // 释放 URL 对象
            window.URL.revokeObjectURL(url);
            
            // 每个文件之间稍微停顿，确保浏览器处理顺滑
            await new Promise(resolve => setTimeout(resolve, 600));
        }
    } catch (error) {
        console.error('下载过程中出错:', error);
    } finally {
        setTimeout(() => {
            downloadText.textContent = originalText;
            btn.disabled = false;
        }, 1000);
    }
}
</script>
{% endblock %}
