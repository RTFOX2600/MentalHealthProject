{% extends 'base.html' %}

{% block title %}首页 - 精准思政系统{% endblock %}

{% block content_wrapper %}
{% load static %}
	<link rel="stylesheet" href="{% static 'css/home.css' %}">

	<div class="hero-section">
	    <h1 class="hero-title">精准思政系统（试运行）</h1>
	    <p class="hero-subtitle">
	        一个有温度、有精度、有效度、AI 驱动的精准思政体系。
	    </p>
	    <div class="hero-cta">
	        {% if user.is_authenticated %}
	            {% if user.role == 'counselor' or user.role == 'admin' %}
	                <a href="{% url 'staff_dashboard:home' %}" class="btn btn-light">进入工作台</a>
	            {% else %}
	                <a href="{% url 'about' %}" class="btn btn-light">了解系统</a>
	            {% endif %}
	            <a href="{% url 'about' %}" class="btn btn-outline-light">了解更多</a>
	        {% else %}
	            <a href="{% url 'login' %}" class="btn btn-light">立即登录</a>
	            <a href="{% url 'register' %}" class="btn btn-outline-light">加入我们</a>
	        {% endif %}
	    </div>
	</div>

	<!-- 个人状态 -->
	{% if user.is_authenticated %}
		<div class="fade-in-up" style="animation-delay: 0.2s; margin-top: -2rem; margin-bottom: 3rem;">
			<div class="status-card" style="text-align: left; max-width: 100%; margin-bottom: 0;">
			    <h3 style="text-align: left;">个人状态</h3>
			    <div>您好，<strong>{{ user.last_name }}{{ user.first_name }}{% if not user.last_name and not user.first_name %}{{ user.username }}{% endif %}</strong>！欢迎回来。</div>
			    <div>当前角色：<span class="badge bg-primary" style="font-size: 0.9rem; padding: 0.4rem 0.8rem;">{{ user.role_display }}</span></div>
			    
			    <!-- 待审核请求 -->
			    {% if pending_requests %}
			    <div style="padding: 1rem;border-radius: 0.75rem;background-color: var(--bg-color);text-align: left;color: var(--muted-text);line-height: 1.6;margin-top: 0.5rem;">
			        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
			            <span class="badge bg-warning" style="font-size: 0.9rem; padding: 0.4rem 0.8rem; color: #664d03;">待审核请求</span>
			            <form id="cancelAllRequestsForm" action="{% url 'cancel_request' %}" method="post" style="display: inline-block;">
			                {% csrf_token %}
			                <button type="button" class="btn btn-sm btn-outline-secondary" style="padding: 0.3rem 0.8rem; font-size: 0.85rem;"
			                        onclick="showConfirmDialog({
			                            title: '确认取消请求',
			                            message: '确定要取消所有待审核请求吗？此操作不可恢复。',
			                            primaryText: '确认取消',
			                            secondaryText: '我再想想',
			                            onPrimary: function() { document.getElementById('cancelAllRequestsForm').submit(); }
			                        })">
			                    取消请求
			                </button>
			            </form>
			        </div>
			        
			        <!-- 请求详情列表 -->
			        <div style="font-size: 0.9rem; color: var(--text-color);">
			            {% for request in pending_requests %}
			            <div style="{% if not forloop.last %}margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);{% endif %}">
			                <div style="font-weight: 600; margin-bottom: 0.4rem; color: var(--primary-color);">● {{ request.type }}</div>
			                <div style="padding-left: 1rem;">
			                    {% for item in request.items %}
			                    <div style="margin-bottom: 0.25rem;">• {{ item }}</div>
			                    {% endfor %}
			                </div>
			            </div>
			            {% endfor %}
			        </div>
			    </div>
			    {% endif %}
			</div>
		</div>
	{% endif %}

	<!-- 简要介绍 -->
	<div class="section-title fade-in-up" style="animation-delay: 0.3s;">
	    <h2>核心服务</h2>
	    <p>我们提供全方位的支持，确保学生的心理健康得到最专业的照顾。</p>
	</div>

	<div class="feature-grid">
	    <div class="fade-in-up" style="animation-delay: 0.4s;">
            <div class="feature-card" style="height: 100%; margin-bottom: 0;">
                <div class="feature-icon-wrapper">
                     <span class="icon" style="-webkit-mask-image: url('{% static 'icons/user.svg' %}'); mask-image: url('{% static 'icons/user.svg' %}'); width: 2.5rem; height: 2.5rem; margin: 0;"></span>
                </div>
                <h3>心理咨询</h3>
                <p>专业的心理咨询师团队与 AI 辅导员，为我校学生提供一对一的线下线上交流与心理服务。</p>
            </div>
        </div>

	    <div class="fade-in-up" style="animation-delay: 0.5s;">
            <div class="feature-card" style="height: 100%; margin-bottom: 0;">
                <div class="feature-icon-wrapper">
                     <span class="icon" style="-webkit-mask-image: url('{% static 'icons/info.svg' %}'); mask-image: url('{% static 'icons/info.svg' %}'); width: 2.5rem; height: 2.5rem; margin: 0;"></span>
                </div>
                <h3>智能分析</h3>
                <p>智能分析学生心理、思想健康状态，提供个性化的建议。</p>
            </div>
        </div>

	    <div class="fade-in-up" style="animation-delay: 0.6s;">
            <div class="feature-card" style="height: 100%; margin-bottom: 0;">
                <div class="feature-icon-wrapper">
                     <span class="icon" style="-webkit-mask-image: url('{% static 'icons/shield.svg' %}'); mask-image: url('{% static 'icons/shield.svg' %}'); width: 2.5rem; height: 2.5rem; margin: 0;"></span>
                </div>
                <h3>隐私保障</h3>
                <p>最高级别的加密处理与隐私保护协议，确保每一条数据的安全。</p>
            </div>
        </div>
	</div>
{% endblock %}
